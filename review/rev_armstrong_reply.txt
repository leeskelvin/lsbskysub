This is a nice, thourough paper with a good comparison of different methods of
background estimation.  Well done!

I have a few comments/questions that I have ordered by section

Introduction

"This algorithm passes the transpose of the spatially varying point spread
function (PSF) as a kernel over the image" - Unless the software has changed
recently, I don't think it actually uses the transpose of the PSF.  It uses a
circular Gaussian approximation to the PSF.  Oh, I see that you describe this
in 4.5.1.  These two descriptions should match.

LSK: Thank you, we will modify the text here to align with Section 4.5.1.

Section 2.1

I think it would be easier to interpret your galaxies density numbers if you use
objects / arcmin^2. I think this is fairly standard in most areas of astronomy.

LSK: Thank you, we'll modify this figure accordingly.

I don’t know if the rainbow color map is the best for astronomical images as it
can introduce artificial structure in data and sometimes hide structure.  Is
there a reason not to use a gray scale color map?

LSK: We can switch to gray scale, and will do so here and elsewhere in the paper
where appropriate, thank you.

Section 2.2

You should not expect the psf to be easily modeled on the HSC coadded data? The
problem comes from discontinuities at the CCD boundaries. How high an order did
you use for the polynomial fit in psfex? Even with a high order, a polynomial
it may have trouble if there are discontinuities. I don’t know how much it
matters for your analysis, but I have seen it produce fairly large residuals in
some regions of the image.  You do include some residual images, but those can
be hard to interpret sometimes.

LSK: We used a PSFVAR_DEGREES polynomial order of 2 to estimate our PSF (i.e.,
the default PSFEx value). We agree that modelling the PSF from the coadded data
may not be preferable, however, in this instance we only require a PSF in order
to generate output PSF-convolved simulated imaging. In that sense, our
simulated images should be directly comparable to our input HSC-type imaging,
and so we think that this is okay to do here.

Section 3.2

Does sextractor give you a PSF deconvolved value of the size?  It seems like
this would be a better fit than using the straight half lite radii.

LSK: Sadly, SExtractor does not give a deconvolved value of size. We could
potentially calculate one, but I'm not sure it's required here. We only need an
estimate of size to help guide our resultant simulated image construction. As a
consequence, I don't think it would modify our simulated images too much if we
were to implement this, certainly not for the largest of objects, and not too
much for the smallest simulated objects either (we have a hard half light radius
lower-limit of 1 pixel).

Since the high density region has a smaller PSF don’t you want your modeling to
match that sample? From Figure 6, it seems like the model is closer to the
larger seeing low density data

LSK: As above, the only purpose of these plots is to approximately mimic a true
HSC dataset in order to generate a set of simulated images.

It is clear that CLASS_STAR does not fully isolate the galaxy sample.  Are these
removed somehow when you try to model the sample?

LSK: Yes, this is correct, CLASS_STAR does not fully remove all point-source
type objects. As shown in the figures throughout Section 3.5, we're trying to
generate overall trend lines which we use to set up simulated imaging. As the
remaining point-sources do not dominate the number density in any particular
regime, and our simulated imaging does not contain point sources, then we
believe our simulated images are robust to this. Furthermore, the brightest exd
(brighter than M_r ~ 22 mag) are entirely simulated in any case, throwing away
any detections from SExtractor and instead using our best-fig log-linear trend
line to assign objects in the bright regime.

Why did you use +- 25% around your fit? This doesn't seem to capture the
variance in the data.

LSK: Although hard to see here, the majority of data do seem to fall within this
regime. There is no alpha-transparency on the data points in Figure 6, so it
might be hard to see this effect. We also didn't want to vary too much away from
+-25% so that we're not being too overly impacted by erroneous source detection
results.

Section 3.4

The ellipticity become larger for fainter sources.  I am guessing this is from
the noise in the measurement and not from the intrinsic distribution. Have you
tried to account for the difference between these factors when modeling your
faint galaxies?

LSK: Somewhat, yes. As shown in Figure 7, our faintest simulated sources are
more circular than those that have been derived from real data. We used the true
ellipticity distribution from brighter magnitude ranges to help derive a model
which gives a prediction for the ellipticity at the faintest magnitudes in our
simulated imaging.

Section 3.5

Why does the super pixel images look so noisy?  Maybe it is related to the
smoothing scale that you used?

LSK: this is the result of a 100x100 pixel binning procedure. Perhaps this will
be clearer on a gray scale (as noted above) in the updated version.

Section 3.9

I don't think you need to include table 1, a description of what it contains in
the text is sufficient.

LSK: A fair point. Rather than remove this, we'll move it into the Appendix
next to the GalSim config file, for reference.

Looking at the yaml file you feed to galsim you use an interpolated image as
the psf, but don't use the draw option 'no_pixel'.  Without this you will apply
the pixel convolution twice.

LSK: (unsure about this one?)

For the psf, do you use a represntative psf with galsim, or do you use the full
psf model?

LSK: we use the PSF derived in Section 2.2.

Section 4.1

How did you arrive at the given power law to extend objects?  How sensitive is
this approach if you change the amount of masking?

LSK: this value was chosen based on testing on our input data, and also to
somewhat mimic that already performed in Ji et al. 2018.

Section 4.2

Can you reliably fit a sersic profile to galaxies at faint magnitude?  We had
some problems doing this with HSC.  As stated in the text this will mostly
affect bright sources, maybe you can focus on these objects.

LSK: We only model sources brighter than m_r = 25 mag (see the second paragraph
of Section 4.2). I hope you agree that this lower limit is sufficient as we do,
precisely for the reasons you describe.

Section 4.3.1

"check images for the segmentation map (BACKGROUND)" should this be
SEGMENTATION?

LSK: yes, thank you!

Section 4.3.2

"There is a long an inglorious history" -> long and inglorious

LSK: thank you!

My understanding is that sextractor does not do deblending?  It only assigns
different pixels to different objects and does not try to separate the flux from
a single pixel into different components.

LSK: Yes, you are correct that SExtractor does not partition flux within one
pixel to multiple objects. However, it does deblend a series of pixels into
multiple objects. I believe that this definition is correct and used in the
literature, but keen to hear from you if you think another description is
appropriate here.

Section 4.3.4

"subtracting our mult-Sersic model image" also "the fitted PSF-convolved
multi-Sersic model" - I thought your model was a single Sersic per galaxy?

LSK: it is multi-Sersic in the sense that there are multiple simulated galaxies
in each frame, but yes, each simulated galaxy is only modelled with a single
Sersic component.

Section 4.4.3

The segmentation map looks strange for the bright sources.  Is this typical for
the Gnuastro processing?

LSK: Strange in what sense? Gnuastro is bottom-up, starting with noise
everywhere and chiseling out sources. As a consequence, it can leave a lot of
ragged edges that those who are familiar with SExtractor (like me) are not
so used to.

Section 4.4.4

"The impact of modelled masks significantly aids the background estimator". - is
this really true?  It seems to have a small effect

LSK: For SExtractor outputs, Figure 18 shows that modelled masking has the
single largest impact, larger than modifying your configuration or using
dilated masking. The effect for Gnuastro outputs is minimal however, as we noted
above and in the text, likely due to the already significant number of pixels
brought in to Gnuastro segmentation maps.

Section 4.5.2

"In the LSST PIPELINES d6 configurations" - what is d6? I guess you mean P6

LSK: yes, thank you.

Your simulations don't include correlated noise from the warping process.  I
think this is the dominant source of correlated noise in the HSC data even more
than the convolution with the PSF.

LSK: (unsure how to answer this.)

Section 5

I assume that the background is 0 in your simulations. I don’t think that is
explicitly stated anywhere.

LSK: Yes, we do write "These simulated images are background subtracted
(i.e., Poisson noise oscillates about a level of zero counts)", however, we
can and should clarify this, thank you.

Is a mean and standard deviation the right metric here.  It seems like you could
get those right but have spatial variation across the image.  Do you have a way
to test that for your different methods? I see that you partially address this
later on.

LSK: (is this referring to Table 3?) Yes, higher-orders are important too,
however, there is already a lot of information to take away in this study, and
we were wary of over-complicating our analyses too much.

Your reported impact of field density on the background level is 0.9 +- 0.8.
This does not seem statistically significant.  Looking at individual cases, it
seems the all sources version is much more impacted than the simulations with
just bright galaxies.  Is the significance reduced by the lower impact from the
bright sims?

LSK: (a good question, one to check)

"The impact of source profile is moderate" - The quoted size is close to the
field density number, why do say it is only moderate?

LSK: (will check)

Did you consider doing a modification to the LSST pipeline where you increase
how much footprints are grown in the detection stage?  This might be able to
mimic the other modifications you made with the other packages.  It wouldn't be
magnitude dependent but would likely improve things.

LSK: At the time of writing, we didn't have direct access to the LSST pipeline
(this began as an external project, before I joined Rubin Obs). We also wanted
to test what others already using the pipeline would find, and so haven't
made any attempt to modify the pipeline at this time.

Without having a lot of background in LSB galaxies, how significant is a 0.5 mag
improvement in the sky estimation? It would be nice if you could connect this to
a specific science application. Maybe this is beyond the scope of this paper?

LSK: (will check)

"Such an obvious trend is likely testament" -> a testament

LSK: thank you.

How do you measure the luminosity for the sources when you compare to the truth?
Are you using cmodel for LSST, mag_auto for SExtractor? Presumably, different
algorithms will perform better.  I'm trying to understand the performance of the
LSST results.  Previous studies I've seen have not shown a large bias.  What is
the trend you see with magnitude?

LSK: we do not use any LSST catalogue outputs here (will clarify in the text)

Conclusion

It seems a bit long to me with too much detail.  I think it would be improved if
you could more succinctly highlight the main results of your paper without going
through all the results one by one.

LSK: thank you, we will re-write and simplify this section.

Appendix C

I don't think you need two figures to demonstrate that galsim does better than
Sextractor.

LSK: thank you, we can remove one of these figures as you suggest.
